var Stone,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Stone = (function(_super) {
  __extends(Stone, _super);

  Stone.soundsPlay = 0;

  function Stone(type, x, y, z, scale) {
    var geometry, height, i, jizz, material, obj, radius, size, v, vertices, _i, _j, _k, _ref, _ref1, _ref2;
    type = 1;
    this.fly = false;
    this.positionnated = false;
    switch (type) {
      case 0:
        size = 5.5 * scale;
        obj = {
          type: 'box',
          size: [size, size, size],
          pos: [x, y, z],
          move: true,
          world: Physics.world
        };
        geometry = new THREE.BoxGeometry(size, size, size, 2, 2, 2);
        material = new THREE.MeshLambertMaterial({
          color: 0xFFFFFF,
          wireframe: false
        });
        vertices = geometry.vertices;
        jizz = 3;
        for (i = _i = 0, _ref = vertices.length; _i < _ref; i = _i += 1) {
          v = vertices[i];
          v.x += (Math.random() - .5) * jizz;
          v.z += (Math.random() - .5) * jizz;
          if (v.y !== -size / 2) {
            v.y += (Math.random() - .5) * jizz;
          }
        }
        break;
      case 1:
        radius = 5 * scale;
        obj = {
          type: 'sphere',
          size: [radius * 0.5, radius * 0.5, radius * 0.5],
          pos: [x, y, z],
          move: true,
          world: Physics.world
        };
        geometry = new THREE.TetrahedronGeometry(radius, 2);
        material = new THREE.MeshLambertMaterial({
          color: 0xFFFFFF,
          wireframe: false
        });
        vertices = geometry.vertices;
        jizz = radius / 2.5;
        for (i = _j = 0, _ref1 = vertices.length; _j < _ref1; i = _j += 1) {
          v = vertices[i];
          v.x += (Math.random() - .5) * jizz;
          v.z += (Math.random() - .5) * jizz;
          v.y += (Math.random() - .5) * jizz;
        }
        break;
      case 2:
        height = 10;
        geometry = new THREE.CylinderGeometry(5, 5, height, 5, 3, false);
        material = new THREE.MeshLambertMaterial({
          color: 0xFFFFFF,
          wireframe: false
        });
        vertices = geometry.vertices;
        jizz = .5;
        for (i = _k = 0, _ref2 = vertices.length; _k < _ref2; i = _k += 1) {
          v = vertices[i];
          if (v.y !== height / 2) {
            v.x += (Math.random() - .5) * jizz;
            v.z += (Math.random() - .5) * jizz;
            v.y += (Math.random() - .5) * jizz;
          }
        }
        obj = {
          type: 'cylinder',
          size: [w, h, w, w, h, w, w, h, w, w, h, w],
          pos: [x, y, z],
          rot: [0, 0, 0, 0, 45, 0, 0, 22.5, 0, 0, -22.5, 0],
          move: true,
          world: Physics.world
        };
        break;
    }
    this.body = new OIMO.Body(obj);
    this.body.body.linearVelocity.set(0, -10, 0);
    this.body.body.mass = 2 + Math.random();
    this.body.body.allowSleep = false;
    material.envMap = Data.textures.reflectionCube;
    material.reflectivity = .7;
    material.transparent = true;
    material.opacity = .8;
    material.fog = true;
    material.combine = THREE.AddOperation;
    THREE.Mesh.call(this, geometry, material);
    this.occlusion = new THREE.Mesh(geometry, Stage3d.postprocessing.blackMaterial);
    return;
  }

  Stone.prototype.update = function(dt, golem) {
    var maxSpeed, speedX, speedY, speedZ, target;
    if (golem) {
      target = this.target;
      maxSpeed = 5;
      speedX = (target.x - this.body.body.position.x) * .75;
      if (speedX > maxSpeed) {
        speedX = maxSpeed;
      } else if (speedX < -maxSpeed) {
        speedX = -maxSpeed;
      }
      speedY = (target.y - this.body.body.position.y) * .75;
      if (speedY > maxSpeed) {
        speedY = maxSpeed;
      } else if (speedY < -maxSpeed) {
        speedY = -maxSpeed;
      }
      speedZ = (target.z - this.body.body.position.z) * .75;
      if (speedZ > maxSpeed) {
        speedZ = maxSpeed;
      } else if (speedZ < -maxSpeed) {
        speedZ = -maxSpeed;
      }
      this.body.body.linearVelocity.set(speedX, speedY, speedZ);
    }
    if (!golem || !this.body.getSleep()) {
      this.position.copy(this.body.getPosition());
      this.quaternion.copy(this.body.getQuaternion());
    }
    this.occlusion.position.copy(this.position);
    this.occlusion.quaternion.copy(this.quaternion);
    return this.occlusion.scale.copy(this.scale);
  };

  return Stone;

})(THREE.Mesh);

//# sourceMappingURL=data:application/json;base64,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QUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQTFCLENBQThCLE1BQTlCLEVBQXFDLE1BQXJDLEVBQTRDLE1BQTVDLENBckJBLENBREQ7S0FBQTtBQXdCQSxJQUFBLElBQUcsQ0FBQSxLQUFBLElBQVUsQ0FBQSxJQUFFLENBQUEsSUFBSSxDQUFDLFFBQU4sQ0FBQSxDQUFkO0FBQ0MsTUFBQSxJQUFDLENBQUEsUUFBUSxDQUFDLElBQVYsQ0FBZSxJQUFDLENBQUEsSUFBSSxDQUFDLFdBQU4sQ0FBQSxDQUFmLENBQUEsQ0FBQTtBQUFBLE1BQ0EsSUFBQyxDQUFBLFVBQVUsQ0FBQyxJQUFaLENBQWlCLElBQUMsQ0FBQSxJQUFJLENBQUMsYUFBTixDQUFBLENBQWpCLENBREEsQ0FERDtLQXhCQTtBQUFBLElBOENBLElBQUMsQ0FBQSxTQUFTLENBQUMsUUFBUSxDQUFDLElBQXBCLENBQXlCLElBQUMsQ0FBQSxRQUExQixDQTlDQSxDQUFBO0FBQUEsSUErQ0EsSUFBQyxDQUFBLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBdEIsQ0FBMkIsSUFBQyxDQUFBLFVBQTVCLENBL0NBLENBQUE7V0FnREEsSUFBQyxDQUFBLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBakIsQ0FBc0IsSUFBQyxDQUFBLEtBQXZCLEVBakRNO0VBQUEsQ0EvRVAsQ0FBQTs7ZUFBQTs7R0FGbUIsS0FBSyxDQUFDLEtBQTFCLENBQUEiLCJmaWxlIjoiZ29sZW0vM2QvU3RvbmUuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTdG9uZSBleHRlbmRzIFRIUkVFLk1lc2hcblxuXHRAc291bmRzUGxheSA9IDBcblxuXHRjb25zdHJ1Y3RvcjoodHlwZSx4LHkseixzY2FsZSktPlxuXG5cdFx0IyB0eXBlID89IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoyKVxuXHRcdHR5cGUgPSAxXG5cdFx0QGZseSA9IGZhbHNlXG5cdFx0QHBvc2l0aW9ubmF0ZWQgPSBmYWxzZVxuXHRcdFxuXHRcdHN3aXRjaCh0eXBlKVxuXHRcdFx0d2hlbiAwXG5cdFx0XHRcdCNnZW9tZXRyeSBjdWJpY1xuXHRcdFx0XHRzaXplID0gNS41KnNjYWxlXG5cdFx0XHRcdG9iaiA9IHsgdHlwZTonYm94Jywgc2l6ZTpbc2l6ZSxzaXplLHNpemVdLCBwb3M6W3gseSx6XSwgbW92ZTp0cnVlLCB3b3JsZDpQaHlzaWNzLndvcmxkIH07XG5cdFx0XHRcdGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KCBzaXplLCBzaXplLCBzaXplICwgMiwgMiwgMiApO1xuXHRcdFx0XHRtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKHtjb2xvcjoweEZGRkZGRiwgd2lyZWZyYW1lOmZhbHNlfSlcblxuXHRcdFx0XHR2ZXJ0aWNlcyA9IGdlb21ldHJ5LnZlcnRpY2VzXG5cdFx0XHRcdGppenogPSAzXG5cdFx0XHRcdGZvciBpIGluIFswLi4udmVydGljZXMubGVuZ3RoXSBieSAxXG5cdFx0XHRcdFx0diA9IHZlcnRpY2VzW2ldXG5cdFx0XHRcdFx0di54ICs9IChNYXRoLnJhbmRvbSgpLS41KSpqaXp6XG5cdFx0XHRcdFx0di56ICs9IChNYXRoLnJhbmRvbSgpLS41KSpqaXp6XG5cdFx0XHRcdFx0aWYodi55ICE9IC1zaXplLzIpXG5cdFx0XHRcdFx0XHR2LnkgKz0gKE1hdGgucmFuZG9tKCktLjUpKmppenpcblx0XHRcdFx0YnJlYWtcdFxuXG5cdFx0XHR3aGVuIDFcblx0XHRcdFx0I2dlb21ldHJ5IGNpcmNsZVxuXHRcdFx0XHRyYWRpdXMgPSA1KnNjYWxlXG5cdFx0XHRcdG9iaiA9IHsgdHlwZTonc3BoZXJlJywgc2l6ZTpbcmFkaXVzKjAuNSwgcmFkaXVzKjAuNSwgcmFkaXVzKjAuNV0sIHBvczpbeCx5LHpdLCBtb3ZlOnRydWUsIHdvcmxkOlBoeXNpY3Mud29ybGQgfVxuXHRcdFx0XHRnZW9tZXRyeSA9IG5ldyBUSFJFRS5UZXRyYWhlZHJvbkdlb21ldHJ5KHJhZGl1cywgMik7XG5cdFx0XHRcdG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoe2NvbG9yOjB4RkZGRkZGLCB3aXJlZnJhbWU6ZmFsc2V9KVxuXG5cdFx0XHRcdHZlcnRpY2VzID0gZ2VvbWV0cnkudmVydGljZXNcblx0XHRcdFx0aml6eiA9IHJhZGl1cy8yLjVcblx0XHRcdFx0Zm9yIGkgaW4gWzAuLi52ZXJ0aWNlcy5sZW5ndGhdIGJ5IDFcblx0XHRcdFx0XHR2ID0gdmVydGljZXNbaV1cblx0XHRcdFx0XHR2LnggKz0gKE1hdGgucmFuZG9tKCktLjUpKmppenpcblx0XHRcdFx0XHR2LnogKz0gKE1hdGgucmFuZG9tKCktLjUpKmppenpcblx0XHRcdFx0XHR2LnkgKz0gKE1hdGgucmFuZG9tKCktLjUpKmppenpcdFxuXHRcdFx0XHRicmVha1x0XG5cblx0XHRcdHdoZW4gMlxuXHRcdFx0XHQjZ2VvbWV0cnkgdHJpYW5nbGVcblx0XHRcdFx0aGVpZ2h0ID0gMTBcblx0XHRcdFx0Z2VvbWV0cnkgPSBuZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSg1LCA1LCBoZWlnaHQsIDUsIDMsIGZhbHNlKVxuXHRcdFx0XHRtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKHtjb2xvcjoweEZGRkZGRiwgd2lyZWZyYW1lOmZhbHNlfSlcblxuXHRcdFx0XHR2ZXJ0aWNlcyA9IGdlb21ldHJ5LnZlcnRpY2VzXG5cdFx0XHRcdGppenogPSAuNVxuXHRcdFx0XHRmb3IgaSBpbiBbMC4uLnZlcnRpY2VzLmxlbmd0aF0gYnkgMVxuXHRcdFx0XHRcdHYgPSB2ZXJ0aWNlc1tpXVxuXHRcdFx0XHRcdGlmKHYueSAhPSBoZWlnaHQvMilcblx0XHRcdFx0XHRcdHYueCArPSAoTWF0aC5yYW5kb20oKS0uNSkqaml6elxuXHRcdFx0XHRcdFx0di56ICs9IChNYXRoLnJhbmRvbSgpLS41KSpqaXp6XG5cdFx0XHRcdFx0XHR2LnkgKz0gKE1hdGgucmFuZG9tKCktLjUpKmppenpcdFxuXG5cdFx0XHRcdG9iaiA9IHsgdHlwZTonY3lsaW5kZXInLCBzaXplOlt3LGgsdywgdyxoLHcsIHcsaCx3LCB3LGgsd10sIHBvczpbeCx5LHpdLCByb3Q6WzAsMCwwLCAwLDQ1LDAsIDAsMjIuNSwwLCAwLC0yMi41LDBdLCBtb3ZlOnRydWUsIHdvcmxkOlBoeXNpY3Mud29ybGQgfTtcblx0XHRcdFx0YnJlYWtcdFxuXG5cdFx0QGJvZHkgPSBuZXcgT0lNTy5Cb2R5KG9iailcblx0XHRAYm9keS5ib2R5LmxpbmVhclZlbG9jaXR5LnNldCgwLC0xMCwwKVxuXHRcdEBib2R5LmJvZHkubWFzcyA9IDIrTWF0aC5yYW5kb20oKVxuXHRcdEBib2R5LmJvZHkuYWxsb3dTbGVlcCA9IGZhbHNlXG5cblx0XHRtYXRlcmlhbC5lbnZNYXAgPSBEYXRhLnRleHR1cmVzLnJlZmxlY3Rpb25DdWJlXG5cdFx0bWF0ZXJpYWwucmVmbGVjdGl2aXR5ID0gLjdcblx0XHRtYXRlcmlhbC50cmFuc3BhcmVudCA9IHRydWVcblx0XHRtYXRlcmlhbC5vcGFjaXR5ID0gLjhcblx0XHRtYXRlcmlhbC5mb2cgPSB0cnVlXG5cdFx0bWF0ZXJpYWwuY29tYmluZSA9IFRIUkVFLkFkZE9wZXJhdGlvblxuXG5cdFx0VEhSRUUuTWVzaC5jYWxsKHRoaXMsIGdlb21ldHJ5LCBtYXRlcmlhbClcblxuXHRcdEBvY2NsdXNpb24gPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgU3RhZ2UzZC5wb3N0cHJvY2Vzc2luZy5ibGFja01hdGVyaWFsKVxuXG5cdFx0cmV0dXJuXG5cblx0dXBkYXRlOihkdCwgZ29sZW0pLT5cblx0XHRpZihnb2xlbSlcblx0XHRcdHRhcmdldCA9IEB0YXJnZXRcblx0XHRcdG1heFNwZWVkID0gNVxuXG5cdFx0XHRzcGVlZFggPSAodGFyZ2V0LngtQGJvZHkuYm9keS5wb3NpdGlvbi54KSouNzVcblx0XHRcdGlmKHNwZWVkWD5tYXhTcGVlZClcblx0XHRcdFx0c3BlZWRYID0gbWF4U3BlZWRcblx0XHRcdGVsc2UgaWYoc3BlZWRYPC1tYXhTcGVlZClcblx0XHRcdFx0c3BlZWRYID0gLW1heFNwZWVkXG5cblx0XHRcdHNwZWVkWSA9ICh0YXJnZXQueS1AYm9keS5ib2R5LnBvc2l0aW9uLnkpKi43NVxuXHRcdFx0aWYoc3BlZWRZPm1heFNwZWVkKVxuXHRcdFx0XHRzcGVlZFkgPSBtYXhTcGVlZFxuXHRcdFx0ZWxzZSBpZihzcGVlZFk8LW1heFNwZWVkKVxuXHRcdFx0XHRzcGVlZFkgPSAtbWF4U3BlZWRcblxuXHRcdFx0c3BlZWRaID0gKHRhcmdldC56LUBib2R5LmJvZHkucG9zaXRpb24ueikqLjc1XG5cdFx0XHRpZihzcGVlZFo+bWF4U3BlZWQpXG5cdFx0XHRcdHNwZWVkWiA9IG1heFNwZWVkXG5cdFx0XHRlbHNlIGlmKHNwZWVkWjwtbWF4U3BlZWQpXG5cdFx0XHRcdHNwZWVkWiA9IC1tYXhTcGVlZFxuXG5cdFx0XHRAYm9keS5ib2R5LmxpbmVhclZlbG9jaXR5LnNldChzcGVlZFgsc3BlZWRZLHNwZWVkWilcblxuXHRcdGlmICFnb2xlbSB8fCAhQGJvZHkuZ2V0U2xlZXAoKVxuXHRcdFx0QHBvc2l0aW9uLmNvcHkoQGJvZHkuZ2V0UG9zaXRpb24oKSlcblx0XHRcdEBxdWF0ZXJuaW9uLmNvcHkoQGJvZHkuZ2V0UXVhdGVybmlvbigpKVxuXG5cdFx0IyBpZihAZmx5ICYmIEBwb3NpdGlvbi55IDwgMTApXG5cdFx0IyBcdEBmbHkgPSBmYWxzZVxuXHRcdCMgXHRpZihTdG9uZS5zb3VuZHNQbGF5PDEpXG5cdFx0IyBcdFx0U3RvbmUuc291bmRzUGxheSsrXG5cdFx0IyBcdFx0RGF0YS5zb3VuZHMuc3RvbmVIaXQyLnBsYXkoKVxuXHRcdCMgXHRcdHIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMylcblx0XHQjIFx0XHREYXRhLnNvdW5kcy5zdG9uZUhpdDIucGxheSgpXG5cdFx0IyBcdFx0IyBpZihyID09IDApXG5cdFx0IyBcdFx0IyBcdERhdGEuc291bmRzLnN0b25lSGl0MS5wbGF5KClcblx0XHQjIFx0XHQjIGVsc2UgaWYociA9PSAxKVxuXHRcdCMgXHRcdCMgXHREYXRhLnNvdW5kcy5zdG9uZUhpdDIucGxheSgpXG5cdFx0IyBcdFx0IyBlbHNlIGlmKHIgPT0gMylcblx0XHQjIFx0XHQjIFx0RGF0YS5zb3VuZHMuc3RvbmVIaXQzLnBsYXkoKVxuXG5cdFx0IyBlbHNlIGlmKCFAZmx5KVxuXHRcdCMgXHRpZihAcG9zaXRpb24ueSA+IDIwKVxuXHRcdCMgXHRcdEBmbHkgPSB0cnVlXG5cblx0XHRAb2NjbHVzaW9uLnBvc2l0aW9uLmNvcHkoQHBvc2l0aW9uKVxuXHRcdEBvY2NsdXNpb24ucXVhdGVybmlvbi5jb3B5KEBxdWF0ZXJuaW9uKVxuXHRcdEBvY2NsdXNpb24uc2NhbGUuY29weShAc2NhbGUpIl19